<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RTW Statusmonitor</title>

  <style>
    :root{
      --bg:#404040;
      --accent:#f5f5f5;
      --rtw1:#00E676;
      --rtw2:#FFB300;
      --warn:#ff9800;
      color-scheme: dark;
    }

    html,body{
      height:100%;
      margin:0;
      font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif;
      background:var(--bg);
      display:grid;
      place-items:center;
    }

    .card{
      background:#404040;
      width:min(90vw,700px);
      text-align:center;
      padding:1.5rem 2rem;
      box-sizing:border-box;
      border-radius:18px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }

    h1{
      margin:0 0 1rem;
      font-size:clamp(1.8rem,3vw,2rem);
      color:var(--accent);
      font-weight: normal;
    }

    .status{
      font-size:clamp(2.5rem,8vw,7rem);
      font-weight:700;
      letter-spacing:2px;
      color:var(--accent);
      transition:color .2s ease;
    }

    footer{
      margin-top:1rem;
      font-size:1.4rem;
      opacity:0.9;
      color:#f5f5f5;
    }

    .geoalert{
      margin-top: 20px;
      padding: 15px 20px;
      background: var(--warn);
      color: #000;
      border-radius: 14px;
      font-size: 1.6rem;
      font-weight: bold;
      text-align: center;
      display: none;
      box-shadow:0 5px 20px rgba(0,0,0,.3);
    }
  </style>
</head>

<body>

  <div class="card">
    <h1>Aktuell in erster Priorität</h1>
    <div class="status" id="status">--</div>
    <footer id="info">Keine Fahrzeuge in Status 2</footer>

    <div id="geoalert" class="geoalert">
      ⚠️ Geoalarmierung beachten
    </div>
  </div>

  <script>
    async function update() {
      let data;

      try {
        const res = await fetch("status.json?_=" + Date.now());
        data = await res.json();
      } catch (e) {
        document.getElementById("status").textContent = "FEHLER";
        document.getElementById("info").textContent = "status.json nicht erreichbar";
        document.getElementById("geoalert").style.display = "none";
        return;
      }

      const now = new Date();
      let longestRTW = null;
      let longestTime = 0;
      let geoAlertActive = false;

      for (const name in data) {
        const entry = data[name];
        const status = Number(entry.status);

        // Geoalarm-Hinweis
        if (status === 1) {
          geoAlertActive = true;
        }

        // Status 2 zählen
        if (status === 2 && entry.since) {
          const since = new Date(entry.since);
          const diff = now - since;

          if (diff > longestTime) {
            longestTime = diff;
            longestRTW = name;
          }
        }
      }

      const statusEl = document.getElementById("status");
      const infoEl = document.getElementById("info");
      const geoEl = document.getElementById("geoalert");
      const rootStyle = getComputedStyle(document.documentElement);

      geoEl.style.display = geoAlertActive ? "block" : "none";

      if (!longestRTW) {
        statusEl.textContent = "--";
        statusEl.style.color = rootStyle.getPropertyValue("--accent");
        infoEl.textContent = "Keine Fahrzeuge in Status 2";
        return;
      }

      statusEl.textContent = longestRTW;

      if (longestRTW === "RTW 1") {
        statusEl.style.color = rootStyle.getPropertyValue("--rtw1");
      } else if (longestRTW === "RTW 2") {
        statusEl.style.color = rootStyle.getPropertyValue("--rtw2");
      } else {
        statusEl.style.color = rootStyle.getPropertyValue("--accent");
      }

      const totalMinutes = Math.floor(longestTime / 60000);
      const hours = Math.floor(totalMinutes / 60);
      const minutes = totalMinutes % 60;

      let timeText = "Seit ";
      if (hours > 0) {
        timeText += `${hours} Std `;
      }
      timeText += `${minutes} Min `;

      infoEl.textContent = timeText;
    }

    update();
    setInterval(update, 5000); // Aktualisierung alle 5 sek
  </script>

</body>
</html>



