<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RTW Dienstplan</title>
  <style>
    :root{
      --bg:#404040;
      --accent:#f5f5f5;
      --rtw1:#00E676;
      --rtw2:#FFB300;
      color-scheme: dark;
    }
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif;
      background:var(--bg);
      display:grid;
      place-items:center;
    }
    .card{
      background:#404040;
      width:min(90vw,700px);
      text-align:center;
      padding:1.5rem 2rem;
      box-sizing:border-box;
      border-radius:18px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    h1{
      margin:0 0 1rem;
      font-size:clamp(1.8rem,3vw,2rem);
      color:var(--accent);
      font-weight: normal;
    }
    .status{
      font-size:clamp(2rem,7vw,6.5rem);
      font-weight:700;
      letter-spacing:2px;
      color:var(--accent);
      transition:color .2s ease;
    }
    footer{
      margin-top:1rem;
      font-size:1.4rem;
      opacity:0.9;
      color:#f5f5f5;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Aktuell in erster Priorität</h1>
    <div class="status" id="status">--</div>
    <footer id="next">Nächste Änderung: --</footer>
  </div>

  <script>
    // Datum/Zeit, ab dem der 4-Std-Rhythmus aktiv sein soll (Europe/Berlin)
    const SWITCH_YEAR = 2025;
    const SWITCH_MONTH = 11; 
    const SWITCH_DAY = 17;
    const SWITCH_HOUR = 7;
    const SWITCH_MINUTE = 30;

    function isBeforeSwitch() {
      const nowStr = new Date().toLocaleString('de-DE', {
        timeZone: 'Europe/Berlin',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const parts = nowStr.split(/[.\s,:]/).filter(Boolean);

      const day = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10);
      const year = parseInt(parts[2], 10);
      const hour = parseInt(parts[3], 10);
      const minute = parseInt(parts[4], 10);

      if (year < SWITCH_YEAR) return true;
      if (year > SWITCH_YEAR) return false;
      if (month < SWITCH_MONTH) return true;
      if (month > SWITCH_MONTH) return false;
      if (day < SWITCH_DAY) return true;
      if (day > SWITCH_DAY) return false;

      if (hour < SWITCH_HOUR) return true;
      if (hour > SWITCH_HOUR) return false;
      return minute < SWITCH_MINUTE;
    }

    const periods = [
      {start: '07:30', end: '11:30', label: 'RTW 2'},
      {start: '11:30', end: '15:30', label: 'RTW 1'},
      {start: '15:30', end: '19:30', label: 'RTW 2'},
      {start: '19:30', end: '23:30', label: 'RTW 1'},
      {start: '23:30', end: '03:30', label: 'RTW 2'},
      {start: '03:30', end: '07:30', label: 'RTW 1'}
    ];

    function getBerlinTimeParts() {
      const timeStr = new Date().toLocaleString('de-DE', {
        timeZone:'Europe/Berlin',
        hour:'2-digit',
        minute:'2-digit',
        hour12:false
      });
      const match = timeStr.match(/(\d{2}):(\d{2})/);
      const hh = parseInt(match[1],10), mm = parseInt(match[2],10);
      return {h:hh, m:mm, minutes: hh*60+mm};
    }

    function parseHM(hm) {
      const [h,m] = hm.split(':').map(Number);
      return h*60 + m;
    }

    function findActive(mins) {
      for (const p of periods) {
        const a = parseHM(p.start), b = parseHM(p.end);
        if (a <= b) {
          if (mins >= a && mins < b) return p;
        } else {
          if (mins >= a || mins < b) return p;
        }
      }
      return null;
    }

    function nextChange(mins) {
      const upcoming = [];
      for (let dayOffset = 0; dayOffset < 2; dayOffset++) {
        for (const p of periods) {
          const end = parseHM(p.end) + dayOffset*24*60;
          upcoming.push(end);
        }
      }
      upcoming.sort((a,b)=>a-b);
      for (const t of upcoming) {
        if (t > mins) {
          const diff = t - mins;
          const hh = Math.floor(diff/60);
          const mm = diff % 60;
          return {inMinutes: diff, text: `${hh}h ${mm}m`};
        }
      }
      return null;
    }

    function setStatusColor(label) {
      const statusEl = document.getElementById('status');
      const rootStyle = getComputedStyle(document.documentElement);
      if (label === 'RTW 1') {
        statusEl.style.color = rootStyle.getPropertyValue('--rtw1');
      } else if (label === 'RTW 2') {
        statusEl.style.color = rootStyle.getPropertyValue('--rtw2');
      } else {
        statusEl.style.color = rootStyle.getPropertyValue('--accent');
      }
    }

    function update() {
      const statusEl = document.getElementById('status');
      const nextEl = document.getElementById('next');

      if (isBeforeSwitch()) {
        const label = 'RTW 1';
        statusEl.textContent = label;
        setStatusColor(label);

        nextEl.innerHTML =
          'Wechsel auf 4-Std-Rhythmus ab Montag,<br>den 17.11.2025 um 07:30 Uhr';

        return;
      }

      const berlin = getBerlinTimeParts();
      const active = findActive(berlin.minutes);
      const label = active ? active.label : '--';
      statusEl.textContent = label;
      setStatusColor(label);

      const next = nextChange(berlin.minutes);
      nextEl.textContent =
        next ? `Änderung in ${next.text}` : 'Nächste Änderung unbekannt';
    }

    update();
    setInterval(update, 10*1000);
  </script>
</body>
</html>


